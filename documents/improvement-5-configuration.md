# Улучшение 5: Управление конфигурацией

## Статус
Новый

## Текущая проблема
Конфигурация загружается из переменных окружения с ограниченной валидацией и без гибкости для использования нескольких источников.

## Улучшение
- Добавить валидацию конфигурации с корректным сообщением об ошибках
- Поддержка нескольких источников конфигурации (переменные окружения, файлы и т.д.)
- Реализовать горячую перезагрузку для динамического изменения конфигурации
- Добавить генерацию документации по конфигурации

## План реализации

### 1. Определить интерфейсы и структуры конфигурации:
Создание файла `internal/types/config_manager_spec.go` с интерфейсами для управления конфигурацией. Определены основные интерфейсы:
- `ConfigManagerSpec` - основной интерфейс менеджера конфигурации с методами для загрузки, получения различных конфигураций, наблюдения за изменениями и валидации
- `ConfigWatcherFunc` - тип функции обратного вызова для уведомлений об изменениях конфигурации
- `ConfigSource` - интерфейс для источников конфигурации с методами загрузки, наблюдения и идентификации

### 2. Создать менеджер конфигурации:
Реализация файла `internal/configuration/config_manager.go` с классом `ConfigManager`, который:
- Управляет несколькими источниками конфигурации
- Устанавливает значения по умолчанию
- Загружает и применяет конфигурацию
- Предоставляет методы для получения различных конфигураций
- Выполняет валидацию конфигурации
- Поддерживает наблюдение за изменениями конфигурации
- Уведомляет о изменениях через систему наблюдателей

### 3. Создать источник конфигурации из переменных окружения:
Реализация файла `internal/configuration/env_source.go` с классом `EnvConfigSource`, который:
- Загружает конфигурацию из переменных окружения с определенным префиксом
- Преобразует значения строк в соответствующие типы данных (число, длительность, логическое значение)
- Поддерживает плоскую структуру ключей с разделителями "."
- Предоставляет заглушку для наблюдения за изменениями (для реального мониторинга нужна дополнительная реализация)

### 4. Создать источник конфигурации на основе файлов:
Реализация файла `internal/configuration/file_source.go` с классом `FileConfigSource`, который:
- Поддерживает форматы JSON и YAML
- Загружает конфигурацию из указанного файла
- Преобразует вложенную структуру в плоскую карту с ключами, разделенными точками
- Наблюдает за изменениями файла конфигурации в реальном времени с помощью fsnotify
- Вызывает функцию обратного вызова при изменении файла

### 5. Создать генератор документации конфигурации:
Реализация файла `internal/configuration/doc_generator.go` с функционалом, который:
- Определяет структуру для описания опций конфигурации
- Генерирует документацию в формате Markdown
- Включает информацию о ключах, переменных окружения, типах, значениях по умолчанию и описаниях
- Отсортировывает опции по ключам
- Создает пример конфигурационного файла в формате YAML

## Преимущества

1. **Гибкость**: Поддержка нескольких источников конфигурации позволяет использовать разные сценарии развертывания
2. **Надежность**: Валидация позволяет обнаруживать ошибки конфигурации на ранних этапах
3. **Документация**: Автоматически генерируемая документация обеспечивает хорошее документирование конфигурации
4. **Обновления в реальном времени**: Горячая перезагрузка позволяет изменять конфигурацию без перезапуска
5. **Типовая безопасность**: Автоматическое преобразование типов предотвращает ошибки типов во время выполнения
6. **Структурированный доступ**: Четкие интерфейсы обеспечивают структурированный доступ к конфигурации
